<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>


    <link rel="stylesheet" href="../fonts/icomoon/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="../css/jquery-ui.css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>


    <link rel="stylesheet" href="../css/aos.css">

    <link href="../css/mdb.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">
</head>

<body>

    <!--Navbar -->
    <nav class="mb-1 navbar navbar-expand-lg navbar-dark ">
        <a class="navbar-brand" style="color: #000;" href="#">Travel Nepal</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-4" aria-controls="navbarSupportedContent-4" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" style="color: #000;" href="addpost.html">
                        <i class="fas fa-file-upload"></i> Add Post
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" style="color: #000;" href="userdashboard.html">
                        <i class="fab fa-instagram"></i> Post</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" style="color: #000;" id="navbarDropdownMenuLink-4" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-user"></i> Profile </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
                        <a class="dropdown-item" href="userprofile.html">My account</a>
                        <a class="dropdown-item" id="logout" href="javascript:void(0);">Log out</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <!--Card image-->

    <div class="container">
        <div class="view">
            <img src="" id="image" href="addpost.html" class="card-img-top" alt="photo">
            <a href="#">
                <div class="mask rgba-white-slight"></div>
            </a>
        </div>

        <!--Title-->
        <div class="card">
            <h3 id="username" value=""> </h3>
            <h3 class="col-ml-4" id="location" value=""></h3>
            <!--Text-->
            <p class="card-text" id="description"></p>
        </div>

    </div>
    <!--/.Card-->

    <div class="mt-5"></div>
    <div class="container">
        <h2 class="page-header">Comments</h2>
    </div>

    <div id="comment"></div>

    <div class="container">
        <form id="commentform">
            <div class="form-group">
                <label for="">Write Your Comment Here</label>
                <textarea class="form-control rounded-0" id="commentsection" placeholder="comment" rows="2"></textarea>
            </div>
            <div class="row form-group">
                <div class="col-md-12">
                    <input type="submit" value="Post" class="btn btn-primary py-2 px-4 text-white">
                </div>
            </div>
        </form>
    </div>
    <footer>
        <div class="footer-copyright text-center py-3">Â© 2018 Copyright:
            <a href="https://mdbootstrap.com/education/bootstrap/" style="color: whitesmoke"> info@travelnepal.com</a>
        </div>

        <ul>
            <a href="#" class="pl-0 pr-3" style="color: white"><i class="fab fa-facebook fa-2x"></i></i></a>
            <a href="#" class="pl-3 pr-3" style="color: white"><i class="fab fa-twitter fa-2x"></i></a>
            <a href="#" class="pl-3 pr-3" style="color: white"><i class="fab fa-snapchat fa-2x"></i></a>
        </ul>
    </footer>

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="../js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="../js/mdb.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="../js/token.js"></script>
    <script type="text/javascript" src="../js/storage.js"></script>
    <script type="text/javascript" src="../js/logout.js"></script>

    <script>
        $(document).ready(function() {
            var url = "http://localhost:5000/api/postDetail/";
            var searchParams = new URLSearchParams(window.location.search);
            var post_id = "";
            if (searchParams.has('id')) {
                post_id = searchParams.get('id');
            }

            if (searchParams.has('id')) {
                url = url + searchParams.get('id');
            }
            var data = {
                'token': localStorage.getItem("token"),
                'id': localStorage.getItem("_id"),
            };

            $.ajax({
                type: 'POST',
                url: url,
                data: data,
                dataType: 'JSON',
                success: function(response) {
                    console.log(response);
                    $('#username').html(response.post.user);
                    $('#location').html(response.post.location);
                    $('#description').html(response.post.description);
                    $('#image').attr("src", "http://localhost:5000/" + response.post.image);
                    var datas = "";
                    $.each(response.comments, function(index) {

                        datas += "<div class='container'>";
                        datas += "<div class='row'>";
                        datas += "<div class='col-md-8'>";
                        datas += "<section class='comment-list'>";
                        datas += "<article class='row'>";
                        datas += "<div class='col-md-2 col-sm-2 hidden-xs'>";
                        datas += "<figure class='thumbnail'>";
                        datas += "<img class='img-fluid' src='../images/userprofile.png' />";
                        datas += "<figcaption class='text-center'>" + response.comments[index].user + "</figcaption>";
                        datas += "</figure>";
                        datas += " </div>";
                        datas += "<div class='col-md-10 col-sm-10'>";
                        datas += "<div class='card arrow left'>";
                        datas += "<div class='card-body'>";
                        datas += "<p>" + response.comments[index].comment + " </p>";
                        datas += " </div>";
                        datas += " </div>";
                        datas += " </div>";
                        datas += "  </article>";
                        datas += " </section>";
                        datas += "  </div>";
                        datas += " </div>";
                        datas += "  </div>";
                    })
                    $("#comment").append(datas);
                },
                error: function() {
                    alert("vayena")
                }
            });
            $("#commentform").submit(function(e) {
                e.preventDefault();
                var searchParams = new URLSearchParams(window.location.search);

                var comment = {
                    'token': localStorage.getItem("token"),
                    '_id': localStorage.getItem("_id"),
                    'post_id': post_id,
                    'username': localStorage.getItem("username"),
                    'comment': $("#commentsection").val(),
                };
                // alert(comment.post_id);
                // alert(comment.token);
                // alert(comment.id)
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:5000/api/users/comment/',
                    data: comment,
                    dataType: 'JSON',
                    success: function(response) {
                        // _form[0].reset();
                        console.log(response);
                        alert("hurray")
                            // if (response.redirect !== undefined && response.redirect) {
                            //     window.location.href = response.redirect_url;
                            // }
                        location.href = "postcomment.html?id=" + post_id;
                    },
                    error: function(error) {
                        console.log(error);

                        alert("laa vayena aabo k garne")
                    }
                })
            })



        })
    </script>
</body>

</html>