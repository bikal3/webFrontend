<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Material Design Bootstrap</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="../css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="../css/style.min.css" rel="stylesheet">
</head>

<body class="grey lighten-3">

    <!-- Sidebar -->
    <div class="sidebar-fixed position-fixed">

        <a class="logo-wrapper waves-effect">
            <img src="" class="img-fluid" alt="">
        </a>

        <div class="list-group list-group-flush">
            <a href="#" class="list-group-item active waves-effect">
                <i class="fas fa-chart-pie mr-3"></i>Dashboard
            </a>
            <a href="user.html" class="list-group-item list-group-item-action waves-effect">
                <i class="fas fa-user mr-3"></i>User</a>
            <a href="dashboard.html" class="list-group-item list-group-item-action waves-effect">
                <i class="fas fa-table mr-3"></i>Post</a>
            <a href="feedback.html" class="list-group-item list-group-item-action waves-effect">
                <i class="fas fa-map mr-3"></i>Feedback</a>
            <a href="#" class="list-group-item list-group-item-action waves-effect">
                <i class="fas fa-money-bill-alt mr-3"></i>Setting</a>
        </div>

    </div>
    <div class="container-fluid" style="border:1px solid #cecece;">
        <div class="container">
            <div class="page-header users-header">
                <h2 style="margin-left: 50%; margin-top: 10% ">
                    Edit User
                    <!-- <a href="user_add.html" class="btn btn-success">Add a new</a> -->
                </h2>
            </div>
            <form id="updateuserform" method="POST">
                <input type="hidden" id="_id" name="_id" value="">
                <fieldset>
                    <div class="modal-body">
                        <div class="md-form form-sm mb-5">
                            <i class="fas fa-user-tie prefix"></i>
                            <input type="text" placeholder="Title " id="title" name="title" value="" class="form-control form-control-sm validate">
                            <label data-error="wrong" data-success="right" class="lbl_status"></label>
                        </div>
                        <div class="md-form form-sm mb-5">
                            <i class="fas fa-envelope prefix"></i>
                            <input type="text" placeholder="Location" id="location" name="location" value="" class="form-control form-control-sm validate">
                            <label data-error="wrong" data-success="right" class="lbl_status" for="modalLRInput12"></label>
                        </div>
                        <div class="md-form form-sm mb-5">
                            <i class="fas fa-envelope prefix"></i>
                            <input type="text" placeholder="description" id="description" name="description" value="" class="form-control form-control-sm validate">
                            <label data-error="wrong" data-success="right" class="lbl_status" for="modalLRInput12"></label>
                        </div>
                        <div class="md-form form-sm mb-5">
                            <i class="fas fa-envelope prefix"></i>
                            <input type="text" placeholder="image" id="image" name="image" value="" class="form-control form-control-sm validate">
                            <label data-error="wrong" data-success="right" class="lbl_status" for="modalLRInput12"></label>
                        </div>
                        <div class="md-form form-sm mb-5">
                            <i class="fas fa-user prefix"></i>
                            <input type="text" placeholder="Username" id="username" name="username" value="" class="form-control form-control-sm validate">
                            <label data-error="wrong" data-success="right" class="lbl_status" for="modalLRInput12"></label>
                        </div>
                        <div class="text-center form-sm mt-2">
                            <button class="btn btn-info" type="submit">Update<i class="fas fa-sign-in ml-1"></i></button>
                        </div>

                    </div>
                </fieldset>
            </form>
        </div>
    </div>
    <!-- Sidebar -->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../js/token.js"></script>
    <script type="text/javascript" src="../js/storage.js"></script>

    <script>
        $(document).ready(function() {
            var id = "";
            var searchParams = new URLSearchParams(window.location.search);
            if (searchParams.has('id')) {
                id = searchParams.get('id');
            }
            var data = {
                'token': localStorage.getItem("token"),
                'id': localStorage.getItem("_id"),
                '_id': id
            };
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:5000/api/admin/postedit/',
                data: data,
                success: function(response) {
                    // console.log(response);
                    $('#title').val(response.title);
                    $('#location').val(response.location);
                    $('#username').val(response.user);
                    $('#description').val(response.description);
                    $('#image').val(response.image);
                },
                error: function() {}
            })
            $("#updateuserform").submit(function(event) {
                event.preventDefault();
                var _form = $(this);
                var id = "";
                var searchParams = new URLSearchParams(window.location.search);
                if (searchParams.has('id')) {
                    id = searchParams.get('id');
                };
                var update = { //Fetch form data

                    'token': localStorage.getItem("token"),
                    'id': localStorage.getItem("_id"),
                    '_id': id,
                    'title': $('input[name=title]').val(),
                    'location': $('input[name=location]').val(),
                    'image': $('input[name=image]').val(),
                    'description': $('input[name=image]').val(),
                    'user': $('input[name=username]').val()
                };
                $.ajax({
                    type: 'PUT',
                    url: 'http://127.0.0.1:5000/api/admin/postupdate/',
                    data: update,
                    success: function(response) {
                        console.log(response);
                    },
                    error: function() {
                        alert("update failed")
                    }
                })
            })
        })
    </script>
</body>

</html>